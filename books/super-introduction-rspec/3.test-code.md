---
title: "RSpecとテストコードの基本"
---
こちらのChapterでは、イベントで必要になる基本概念を解説していきます。
RSpecの復習として触れていただければと思います。
## RSpecの基本構造
RSpecの場合、以下のブロック構造を使用します。
- `describe`(テスト対象のグループ)
- `context`(テストを行う前提条件)
- `it`(テスト内容)
### describe
`describe`はテスト対象をグループ化して整理する役割を担います。
グループ化をして整理することで、**テストの目的や構造**が明確になります。
### context
`context`はテストをする前の**前提条件**や、**正常系・異常系**などを記述する役割を担います。
### it
`it`はテストの内容を記述します。他にも`example`や`specify`などのエイリアスが存在していますが、テスト上の処理はほとんど同じになります。なので今回のイベントでは`it`のみを使用していきます。

基本的には以下のような`describe`→`context`→`it`という入れ子構造になります。
```ruby:models/book_spec.rb
RSpec.describe Book, type: :model do
# Bookモデルのテストをグループ化
  describe "Book#title_with_author" do
  # 書籍のタイトルに関連するテストをグループ化
    context "Book#titleが文字列のとき" do
    # 状況・条件を説明する
      it "titleとauthorを結んだ文字列が返ること" do
      # テスト内容
        book = Book.new(title: "RubyBook", author: "matz")
        expect(book.title_with_author).to eq("RubyBook - matz")
      end
    end
    context "Book#titleがnilのとき" do
    # 状況・条件を説明する
      it "空のtitleとauthorを結んだ文字列が返ること" do
      # テスト内容
        book = Book.new(author: "matz")
        expect(book.title_with_author).to eq(" - matz")
      end
    end
  end
end
```
## expect(検証用メソッド)
テストが要件に通るか検証するためのメソッドになります。
基本的に`expect(実行処理内容).to マッチャ`という文法で使用されます。まず`expect`メソッドの引数に実行する処理を記述(値やメソッドなど)し、指定した**期待値**と比べることで実際の挙動が要件通りなのかどうかを判定します。
期待値と実際の値を比較には後述する**マッチャー**を使います。

## マッチャー
マッチャーとは先程お話した通り、期待値と実際の値を**比較**した結果を出力するために使われるオブジェクトになります。
文章で書いていても分かりづらいと思うので、上記に書いたモデルスペックを例に解説します。
```ruby:models/book_spec.rb
〜〜
it "titleとauthorを結んだ文字列が返ること" do
  # Bookモデルのインスタンスを作成
  book = Book.new(title: "RubyBook", author: "matz")
  # Bookモデルのtitle_with_authorを対象。eqで完全一致しているかチェック
  expect(book.title_with_author).to eq("RubyBook - matz")
〜〜
```
まず`book`に**title**、**author**の値を代入したBookモデルのインスタンスを格納します。
次に`expect`メソッドの引数に、Bookモデル内で定義している**title_with_author**メソッドを呼び出しています。
```ruby:models/book.rb
class Book < ApplicationRecord
  def title_with_author
    "#{title} - #{author}"
  end
end
```
今回のメソッドは**本のタイトル**と**著者名**を "-"(ハイフン)で繋げる内容になります。
なので`title_with_author`メソッドの返り値は"**RubyBook - matz**"と出力されます。

そしていよいよマッチャーが使われます。マッチャーは**to**の後ろに記述されるので、今回のテストコードのマッチャーは`eq(期待値)`です。
`eq(期待値)`は実際の値と期待値が**完全一致**しているか比較するマッチャーになります。なので

実際の値 = "RubyBook - matz"
期待値　 = "RubyBook - matz"

今回の場合、どちらの値も**完全一致**している事が確認できました。テストは成功となります。

マッチャーは様々な種類が存在しているので、条件に合わせて各々調べてみましょう！
[RSpec公式ドキュメント マッチャー一覧](https://rspec.info/features/3-12/rspec-expectations/built-in-matchers/)
[Module: RSpec::Matchers](https://www.rubydoc.info/gems/rspec-expectations/RSpec/Matchers)
[RSpecでよく使うmatcherの種類](https://qiita.com/Hashimoto-Noriaki/items/bafbdac8e6a2fe1fd8b1)